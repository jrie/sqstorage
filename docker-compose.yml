version: "3.0"

networks:
  sqstorage:
    name: sqstorage

services:
  php:
    image: sqstorage:master
    build: .
    volumes:
      - "./:/app"
      - "./dba.php:/app/support/dba.php:rw"
    working_dir: /app
    entrypoint: ["/bin/sh", "-c", "chown -R www-data:www-data /app && php-fpm"]
    networks:
      - sqstorage

  db:
    image: mariadb:10.4
    environment:
      - MYSQL_DATABASE=tlv
      - MYSQL_USER=tlvUser
      - MYSQL_PASSWORD=tlvUser
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
    networks:
      - sqstorage

  web:
    image: nginx:alpine
    ports:
      - "1337:80"
    volumes:
      - "./nginx.conf:/etc/nginx/conf.d/default.conf"
      - "./:/app"
    networks:
      - sqstorage

volumes:
  app:
